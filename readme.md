# –∑–∞–ö–∏–ª–æ Extension

[![PR Checks](https://github.com/SyrnikovPavel/zaKilo-extension/actions/workflows/pr-checks.yml/badge.svg)](https://github.com/SyrnikovPavel/zaKilo-extension/actions/workflows/pr-checks.yml)
[![Build and Release](https://github.com/SyrnikovPavel/zaKilo-extension/actions/workflows/build-and-release.yml/badge.svg)](https://github.com/SyrnikovPavel/zaKilo-extension/actions/workflows/build-and-release.yml)

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã –∑–∞ –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏.

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–≤–µ–¥–µ–Ω —Å JavaScript –Ω–∞ TypeScript –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–æ–¥–∞.

## üöÄ CI/CD –∏ –†–µ–ª–∏–∑—ã

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ CI/CD —á–µ—Ä–µ–∑ GitHub Actions:

### üìã –ü—Ä–æ–≤–µ—Ä–∫–∏ Pull Request'–æ–≤

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ PR
- **–ü—Ä–æ–≤–µ—Ä–∫–∏:** TypeScript —Ç–∏–ø—ã, ESLint, —Ç–µ—Å—Ç—ã (Vitest)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ Node.js:** 18.x, 20.x
- **–¢–µ—Å—Ç–æ–≤–∞—è —Å–±–æ—Ä–∫–∞:** –î–ª—è Chrome –∏ Firefox

### üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–ª–∏–∑—ã

- **–¢—Ä–∏–≥–≥–µ—Ä:** Push –≤ main –≤–µ—Ç–∫—É
- **–ü—Ä–æ—Ü–µ—Å—Å:**
  - –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
  - –°–±–æ—Ä–∫–∞ –¥–ª—è Chrome –∏ Firefox
  - –°–æ–∑–¥–∞–Ω–∏–µ GitHub —Ä–µ–ª–∏–∑–∞ —Å –≤–µ—Ä—Å–∏–µ–π –∏–∑ `package.json`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ `.zip` —Ñ–∞–π–ª–æ–≤

### üì¶ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–æ–≤

–ì–æ—Ç–æ–≤—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ [Releases](https://github.com/SyrnikovPavel/zaKilo-extension/releases):

- `zaKilo-chrome-{version}.zip` ‚Äî –¥–ª—è Chrome
- `zaKilo-firefox-{version}.zip` ‚Äî –¥–ª—è Firefox

---

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

   ```bash
   git clone https://github.com/ruimage/zaKilo-extension.git
   cd zaKilo-extension
   npm ci
   ```

2. –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å HMR

   –î–æ–±–∞–≤–ª–µ–Ω —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π –º–æ–¥—É–ª–µ–π (HMR). –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

   - Chrome:
     ```bash
      npm run build:chrome
     ```
   - Firefox:
     ```bash
     npm run build:firefox
     ```

3. –°–±–æ—Ä–∫–∞ dev-–ø–∞–∫–µ—Ç–æ–≤:

   - Chrome:
     ```bash
     npm run build:chrome
     ```
   - Firefox:
     ```bash
     npm run build:firefox
     ```

4. Linting

Pre-commit lint-staged hooks a–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é –ª–∏–Ω—Ç–∏–Ω–≥ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö.

- –ó–∞–ø—É—Å—Ç–∏—Ç—å eslint: `npm run lint`
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º: `npm run lint:fix`

5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Vitest.

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:

```bash
npm test
```

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ —Å –æ—Ç—á–µ—Ç–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è:

```bash
npm run coverage
```

Pre-commit lint-staged hooks a–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç—ã –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö.

6. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–ø–∞–∫–µ—Ç–æ–≤:

   - Chrome:
     ```bash
     npm run pack:chrome
     ```
   - Firefox:
     ```bash
     npm run pack:firefox
     ```

7. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

   - **Chrome**:
     1. –û—Ç–∫—Ä—ã—Ç—å `chrome://extensions/`
     2. –í–∫–ª—é—á–∏—Ç—å ¬´–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞¬ª
     3. –ù–∞–∂–∞—Ç—å ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ¬ª –∏ —É–∫–∞–∑–∞—Ç—å –ø–∞–ø–∫—É `dist/chrome`
   - **Firefox**:
     1. –û—Ç–∫—Ä—ã—Ç—å `about:debugging#/runtime/this-firefox`
     2. –ù–∞–∂–∞—Ç—å ¬´Load Temporary Add-on¬ª
     3. –í—ã–±—Ä–∞—Ç—å `dist/firefox/manifest.json`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `manifests/` ‚Äî —à–∞–±–ª–æ–Ω—ã –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ (base + per-browser)
- `src/`
  - `background/` ‚Äî —Ñ–æ–Ω–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
  - `content/` ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç—ã
  - `core/` ‚Äî –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ (BaseParser, ParserStrategy)
  - `strategies/` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è —Å–∞–π—Ç–æ–≤
  - `types/` ‚Äî TypeScript —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
  - `utils/` ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü)
- `public/icons/` ‚Äî –∏–∫–æ–Ω–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- `vite.config.mjs` ‚Äî –∫–æ–Ω—Ñ–∏–≥ —Å–±–æ—Ä–∫–∏
- `tsconfig.json` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥ TypeScript
- `tsconfig.node.json` ‚Äî –∫–æ–Ω—Ñ–∏–≥ TypeScript –¥–ª—è Node.js
- `dist/` ‚Äî dev-—Å–±–æ—Ä–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- `ext-dist/` ‚Äî production-—Å–±–æ—Ä–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä–æ–≤

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** –≤ `src/strategies/–ò–º—è–°–∞–π—Ç–∞Strategy.ts` –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞:

   - –ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –æ—Ç `ParserStrategy`.
   - –£–∫–∞–∑–∞—Ç—å `strategyName` –∏ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–∞—Ä—Ç–æ—á–∫–∏.
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã:
     - `parsePrice(cardEl: HTMLElement): number` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–Ω—ã.
     - `parseQuantity(cardEl: HTMLElement): UnitLabel` ‚Äî —Ä–∞–∑–±–æ—Ä –æ–±—ä—ë–º–∞/–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.
     - `renderUnitPrice(cardEl: HTMLElement, unitPrice: number, unitLabel: string): void` ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–∞
       –µ–¥–∏–Ω–∏—á–Ω–æ–π —Ü–µ–Ω—ã.

2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é** –≤ `src/strategies/index.ts`:

   ```typescript
   import { –ò–º—è–°–∞–π—Ç–∞Strategy } from "./–ò–º—è–°–∞–π—Ç–∞Strategy";

   export {
     // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
     –ò–º—è–°–∞–π—Ç–∞Strategy,
   };
   ```

3. **–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç** `src/content/–∏–º—è—Å–∞–π—Ç–∞.ts`:

   ```typescript
   import { –ò–º—è–°–∞–π—Ç–∞Strategy } from "../strategies";
   import { BaseParser } from "../core/BaseParser";

   (function boot(): void {
     const parser = new BaseParser(new –ò–º—è–°–∞–π—Ç–∞Strategy());
     parser.init();
   })();
   ```

4. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ** –≤ `src/background/background.ts`:

   ```typescript
   const siteMap: SiteConfig[] = [
     // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
     {
       match: ["*://*.–¥–æ–º–µ–Ω.—Ä—É/*"],
       script: "src/content/–∏–º—è—Å–∞–π—Ç–∞.js", // –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
     },
   ];
   ```

5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é**, —É–±–µ–¥–∏–≤—à–∏—Å—å, —á—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —Å–∞–π—Ç–µ.
